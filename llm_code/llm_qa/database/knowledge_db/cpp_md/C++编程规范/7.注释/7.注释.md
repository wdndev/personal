# 7.注释

### 7.注释

**注意**：注释固然很重要， 但最好的代码应当本身就是文档。有意义的类型名和变量名， 要远胜过要用注释解释的含糊不清的名字。

#### 7.1.注释风格

**规则**

文件注释、类注释、函数注释、实现注释、结构体注释、枚举注释使用`/* */`方式；

变量、说明、类结尾等单行注释使用`//`方式；

若`/**/`注释方式，编译出现Bug，可使用`//`代替`/**/`，优先使用`/**/`。

**说明**

注释的内容要清楚、明了，含义准确，防止注释二义性；

在代码的功能、意图层次上进行注释，即注释解释代码难以直接表达的意图，而不是重复描述代码。

#### 7.2.文件注释

**规则**

文件头部应进行注释，注释必须列出：文件名、功能说明、生成日期、作者姓名等，头文件的注释中还应有函数功能简要说明。

**说明**

如果一个 `.h` 文件声明了多个概念，则文件注释应当对文件的内容做一个大致的说明， 一个一到两行的文件注释就足够了， 对于每个概念的详细文档应当放在各个概念中， 而不是文件注释中。

如果你对原始作者的文件做了重大修改，请考虑删除原作者信息；

不要在 `.h` 和 `.cpp` 之间复制注释， 这样的注释偏离了注释的实际意义；

注意：注释除第一行无空格，其余每行开头有一个空格。

**示例**

```c++
/**
 * @file        - vino_base.h
 * @author      - wdn(35b180@gree.com.cn)
 * @brief       - OpenVINO基类
 * @version     - 0.1
 * @date        - 2021-01-08
 * 
 * @copyright   - Copyright (c) 2021 GREE EDI Corporation
 * 
 */
```

#### 7.3.类注释

**规则**

每个类的定义都要附带一份注释，描述类的功能和用法，除非它的功能相当明显。

**说明**

类注释应当为读者理解如何使用与何时使用类提供足够的信息，同时应当提醒读者在正确使用此类时应当考虑的因素。

如果你想用一小段代码演示这个类的基本用法或通常用法，放在类注释里也非常合适。

如果类的声明和定义分开了（例如分别放在了 `.h` 和 `.cpp` 文件中），此时，描述类用法的注释应当和接口定义放在一起， 描述类的操作和实现的注释应当和实现放在一起。

**示例**

```c++
/**
 * OpenVINO 基类，定义类型
 */
class VinoBase{
public:
  // do something
protected:
  // do something
}; //class VinoBase
```

#### 7.4.函数注释

**规则**

函数声明处的注释描述函数功能；

定义处的注释描述函数实现。

**说明**

*函数声明*

基本上每个函数声明处前都应当加上注释， 描述函数的功能和用途。只有在函数的功能简单而明显时才能省略这些注释（例如，简单的取值和设值函数）。

函数声明处注释的内容：

-   函数的输入输出；
-   对类成员函数而言：函数调用期间对象是否需要保持引用参数，是否会释放这些参数；
-   函数是否分配了必须由调用者释放的空间；
-   参数是否可以为空指针；
-   是否存在函数使用上的性能隐患；
-   如果函数是可重入的, 其同步前提是什么?

*函数定义*

如果函数的实现过程中用到了很巧妙的方式， 那么在函数定义处应当加上解释性的注释。

*不要* 从 `.h` 文件或其他地方的函数声明处直接复制注释。 简要重述函数功能是可以的， 但注释重点要放在如何实现上。

**示例**

*函数声明*

```c++
/**
 * 同步推理
 *
 * @param frame         - 推理图片，可以 resize 到模型输入大小
 * @param threshold     - 置信阈值
 * @param result        - 推理结果
 * 
 * @return              - 函数运行标志位
 * 
 */
infer_ret_t start_infer(cv::Mat& frame, float threshold, cv::Mat& result);
```

*函数定义*

```c++
/**
 * 同步推理
 */
infer_ret_t MotorSegmentation::start_infer(cv::Mat& frame, float threshold, cv::Mat& result)
{
  // do something
    return VINO_SUCCESS;
}
```

#### 7.5.实现注释

**规则**

对于代码中巧妙的、晦涩的、有趣的、重要的地方加以注释。

**说明**

巧妙或复杂的代码段前要加注释， 比如：

```c++
// 注释
for (int i = 0; i < result->size(); i++) {
    // do something
}
```

比较晦涩的地方在行尾加入注释， 在行尾空两格进行注释，比如：

```c++
if (mmap_budget >= data_size_ && !MmapData(mmap_chunk_bytes, mlock))
  return;  // 错误返回.
```

如果需要连续进行多行注释， 可以使之对齐获得更好的可读性：

```c++
DoSomething();                   // 注释
DoSomethingElseThatIsLonger();   // 注释
{ 
  DoSomethingElse();      // 注释
}
```

#### 7.6.TODO注释

**规则**

对那些临时的， 短期的解决方案， 或已经够好但仍不完美的代码使用 `TODO` 注释。

**说明**

`TODO` 注释要使用全大写的字符串 `TODO`， 在随后的圆括号里写上你的名字，或其它身份标识和与这一 `TODO` 相关的 issue。

**示例**

```c++
// TODO: 是否要等待???
```

#### 7.7.其他注释

**规则**

通常变量名本身足以很好说明变量用途。某些情况下，也需要额外的注释说明。

**说明**

*变量注释*

```c++
/**
 * 推理输入图片
 */
image_size_t m_infer_img_size;
```

*命名空间*

```c++
/**
 * 辅助函数命名空间
 */
namespace helper{
  // do something
}  // namespace helper
```

*#define*

```c++
#ifndef VINO_HELPER_H
#define VINO_HELPER_H
// do something
#endif // VINO_HELPER_H
```

*不允许的注释*

不要注释显而易见的现象。

```c++
// 查找vector中element.      <-- 差: 这太明显了!
auto iter = std::find(v.begin(), v.end(), element);
if (iter != v.end()) 
{
  Process(element);
}
```
