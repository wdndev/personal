# 5.函数

### 5.函数

#### 5.1.参数顺序

**规则**

函数的参数顺序为：输入参数在先， 后跟输出参数。

**说明**

输入参数通常是值参或 `const` 引用， 输出参数一般为非 `const` 指针；

在排列参数顺序时，将所有的输入参数置于输出参数之前。 特别要注意， 在加入新参数时不要因为它们是新参数就置于参数列表最后，而是仍然要按照前述的规则，即将新的输入参数也置于输出参数之前。

这并非一个硬性规定。输入/输出参数 (通常是类或结构体) 让这个问题变得复杂。 并且， 有时候为了其他函数保持一致，你可能不得不有所变通。

#### 5.2.编写简短函数

**规则**

编写简短，凝练的函数。

函数参数要有合法性检查， 对函数错误要有错误码处理。

**说明**

承认长函数有时是合理的，因此并不硬性限制函数的长度。如果函数超过 40 行，可以思索一下能不能在不影响程序结构的前提下对其进行分割。

即使一个长函数现在工作的非常好， 一旦有人对其修改， 有可能出现新的问题，甚至导致难以发现的 bug。使函数尽量简短， 以便于他人阅读和修改代码。

#### 5.3.参数传递

**规则**

函数所有传入参数使用引用传递；

建议函数传出参数使用指针传递，返回函数运行状态；一些确定运行不会出错的函数，可以无返回值，使用`void`；

所有按引用传入的参数必须加上 `const`。

**定义**

在 C 语言中， 如果函数需要修改变量的值，参数必须为指针， 如 `int foo(int *pval)`。 在 C++ 中， 函数还可以声明为引用参数： `int foo(int &val)`。

**说明**

输入参数是值参或 `const` 引用，输出参数为指针。 输入参数可以是 `const` 指针， 但决不能是非 `const` 的引用参数， 除非特殊要求， 比如 `swap()`。

大多时候输入形参往往是 `const T&`， 若用 `const T*` 则说明输入另有处理。 所以若要使用 `const T*`， 则应给出相应的理由。

**示例**

```c++
void Foo(const string &in, string *out);
int Bar(const string &in, string *out)
{
    ...      
    return 0;
}
```

#### 5.4.缺省参数

**规则**

只允许在非虚函数中使用缺省参数，且必须保证缺省参数的值始终一致。

缺省参数与`函数重载`遵循同样的规则。 一般情况下建议使用函数重载，尤其是在缺省函数带来的可读性提升不能弥补下文中所提到的缺点的情况下。

**说明**

对于虚函数， 不允许使用缺省参数，因为在虚函数中缺省参数不一定能正常工作。 如果在每个调用点缺省参数的值都有可能不同， 在这种情况下缺省函数也不允许使用。

缺省参数实际上是函数重载语义的另一种实现方式，一般情况下建议使用函数重载。

#### 5.5.函数返回类型后置语法

**规则**

只有在常规写法 (返回类型前置) 不便于书写或不便于阅读时使用返回类型后置语法。

**定义**

C++ 现在允许两种不同的函数声明方式。 以往的写法是将返回类型置于函数名之前， 例如：

```c++
int foo(int x);
```

C++11 引入了这一新的形式，现在可以在函数名前使用 `auto` 关键字，在参数列表之后后置返回类型，例如：

```c++
auto foo(int x) -> int;
```

后置返回类型为函数作用域。对于像 `int` 这样简单的类型， 两种写法没有区别。 但对于复杂的情况， 例如类域中的类型声明或者以函数参数的形式书写的类型，写法的不同会造成区别。

**说明**

后置返回类型是显式地指定`Lambda 表达式`的返回值的唯一方式。

在大部分情况下，应当继续使用以往的函数声明写法，即将返回类型置于函数名前。只有在必需的时候 (如Lambda 表达式) 或者使用后置语法能够简化书写并且提高易读性的时候才使用新的返回类型后置语法。
