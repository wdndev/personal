# 2.extern C

> **详述**：extern"C"的作用？

C++中被调用C编译后的函数需要加extern C。首先extern是C/C++语言中表明函数和全局变量作用范围的关键字，该关键字告诉编译器，其声明的函数和变量可以在本模块或者其他模块中使用。

通常，在模块的头文件中对本模块提供给其它模块引用的函数和全局变量以关键字extren声明。extrenC是连接声明（linkage declaration）,被extern"C"修饰的变量和函数是按照C语言方式编译和连接的。作为一个面向对象的语言，C++支持函数重载，而过程式语言C则不支持。函数被C++编译后在符号库中的名字与C语言的不同。例如，假设某个函数的原型为：`void foo(int x,int y);`该函数被C编译器编译后在符号库中的名字为\_foo，而C++编译器则会产生像`_foo_int_int`之类的名字。这样的名字包含了函数名、函数参数数量及类型信息，C++就是靠这种机制来实现函数重载的。

所以，可以用一句话概括extern"C"这个声明的真实目的：**解决名字匹配问题，实现C++与C的混合编程**。

C++编译的时候为了解决函数多态的问题，会将函数名和参数联合在一起生成一个中间的函数名称，而C中却不会，因此会造成链接时无法找到对应函数的情况。这时候用到extern"C"告诉编译器，请保持我的名称，不要给我生成用于链接的中间函数名。

1.  现在要写一个c语言的模块，供以后使用（以后的项目可能是c的也可能是c++的），源文件事先编译好，编译成.so或.o都无所谓。头文件中声明函数时要用条件编译包含起来，如下：
    ```c++
    #ifdef __cpluscplus  
    extern "C" {  
    #endif  
      
    //some code  所有函数声明
      
    #ifdef __cplusplus  
    }  
    #endif  

    ```
2.  如果这个模块已经存在了，可能是公司里的前辈写的，反正就是已经存在了，模块的.h文件中没有extern"C"关键字，这个模块又不希望被改动的情况下，可以这样，在你的c++文件中，包含该模块的头文件时加上extern"C",如下：
    ```c++
    extern "C" {  
    #include "test_extern_c.h"  
    } 

    ```
3.  上面例子中，如果仅仅使用模块中的1个函数，而不需要include整个模块时，可以不include头文件，而单独声明该函数，像这样:
    ```c++
    extern "C"{  
    int ThisIsTest(int, int);            
    } 
    ```

注意:当单独声明函数时候，就不能要头文件，或者在头文件中不能写externintThisIsTest(inta,intb);否则会有errorC2732:链接规范与"ThisIsTest"的早期规范冲突，这个错误。

extern修饰变量和函数

修饰符extern用在变量或者函数的声明前，用来说明"**此变量/函数是在别处定义的，要是此处引用**"。extern声明不是定义，即不分配存储空间。

那么也就是说用两种方法去访问其他文件中定义的函数与变量：

1.  使用头文件包含，然后声明他们，并包含头文件
2.  其他文件中直接extern

声明和定义知识点：

-   定义也是声明，extern声明不是定义，即不分配存储空间。extern告诉编译器变量在其他地方定义了。
    ```c++
    extern int i; //声明，不是定义
    int i; //声明，也是定义
    ```
-   如果声明有初始化式，就被当作定义，即使前面加了extern。只有当extern声明位于函数外部时，才可以被初始化。
    ```c++
    extern double pi=3.1416; //定义
    ```
-   函数的声明和定义区别比较简单，带有{}的就是定义，否则就是声明。
    ```c++
    extern double max(double d1,double d2); //声明
    double max(double d1,double d2){} //定义
    ```
-   除非有extern关键字，否则都是变量的定义。
    ```c++
    extern inti; //声明
    inti; //定义
    ```

程序设计风格：

-   不要把变量定义放入.h文件，这样容易导致重复定义错误。
-   尽量使用static关键字把变量定义限制于该源文件作用域，除非变量被设计成全局的。
-   可以在头文件中声明一个变量，在用的时候包含这个头文件就声明了这个变量。
